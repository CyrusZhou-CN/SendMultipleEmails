# 开发文档

## 软件设置

软件的初始设置位于 `Data\default.json`，此位置不可更改。

在该文件中，可以定义数据库位置等其它默认的基础参数。

## 数据库

数据库采用 `LiteDb` 数据库。本项目中有两个库。分别是用户登陆的全局数据库以及用户名下的具体数据库。

### 全局数据库

全局数据库只有一个，即用户账户库，它位于：`Data\data.db`，用户库中，不仅记录了用户数据，也记录了用户的界面状态。

### 用户组数据库

本数据库中主要有以下集合。

- 发件人

- 收件人

- 发件历史

## 用户数据目录

当用户登陆后，会在用户数据的目录中，建立 `userId` 目录，然后里面保存属于用户的数据。

- Data 目录
- Template 目录
- Image 目录

## 分布式

最理想的情况是 P2P 进行分布式通信，但是这样实现时间成本太高。本程序通过设计一个通信中心来处理分布式任务。

中心分布式支持多用户，所以要进行用户隔离。

### 基本流程

1. 主发件端创建原始邮件数据
2. 根据发件箱和可用的代理端来制定发送规则，将每一封邮件通过代理端进行发送（自己也是代理端之一，称之为主代理），公网ip不一样时，才是有效代理。
3. 在第一次向代理端发送指令时，要获取代理端的配置，代理端可以设置不代理发件。
4. 主代理根据设置，判断是发送原内容还是处理过后的内容。
5. 如果某个终端失败，就将任务流转给其它可用终端继续发件
6. 在初始终端中记录各个终端的发件状态，进度条需要重新优化
7. 在每个分终端中也需要记录发件情况，并可通过管理员账号查看代发情况

## 首页展示

- [x] 首页显示送达率
- [x] 不同邮箱类型的发件数量

## 后端服务

- [x] 所有api重构成异步

## 开发待办

### v 0.4.6 版本

- [ ] 选中组时，人员也跟着选中

- [ ] 允许有空姓名存在

- [ ] 进度条采用 websocket 方式获取

- [ ] 头像处的使用说明链接修改

- [ ] 发件过程中支持暂停、取消和继续

  暂停也是终止任务，继续时是将任务继续发送

- [ ] 发件历史中支持单条数据的重发

- [ ] 导入邮件时，左下角的数据总数显示错误

- [ ] 模板使用过程中，模块保存提示不准确

- [ ] 模板中添加注释来混淆内容

- [ ] 添加 Lisence

- [ ] 数据库添加版本号，方便用于自动升级

- [ ] 对登陆密码进行加密保存

- [ ] 添加关闭到托盘功能

  需要测试转为图片是否正确

### v0.5.1 版本

该版本考虑付费中转服务器付费

- [ ] 支持分布式发件
- [ ] 界面与 http 服务分离



